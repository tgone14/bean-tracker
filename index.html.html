<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bean - Dialysis Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .bean-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .progress-bar-bg { background-color: #e5e7eb; border-radius: 9999px; height: 1.5rem; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.5s ease-in-out; }
        .pill-badge { background-color: #e0f2fe; color: #0369a1; border: 1px solid #bae6fd; }
    </style>
</head>
<body class="pb-20">

    <header class="bean-gradient text-white p-6 shadow-lg rounded-b-3xl mb-6">
        <div class="flex justify-between items-center max-w-md mx-auto">
            <div>
                <h1 class="text-3xl font-bold">Bean</h1>
                <p class="text-sm opacity-90">Renal Diet & Binder Tracker</p>
            </div>
            <div class="text-4xl">ü´ò</div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-6">

        <details class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 group">
            <summary class="list-none flex justify-between items-center cursor-pointer font-semibold text-gray-700">
                <span>‚öôÔ∏è Set Daily Limits</span>
                <span class="text-gray-400 group-open:rotate-180 transition-transform">‚ñº</span>
            </summary>
            <div class="mt-4 grid grid-cols-3 gap-3">
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Potassium</label>
                    <input type="number" id="limit-k" class="w-full bg-gray-50 border p-2 rounded-lg" onchange="saveSettings()">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Phosphorus</label>
                    <input type="number" id="limit-p" class="w-full bg-gray-50 border p-2 rounded-lg" onchange="saveSettings()">
                </div>
                <div>
                    <label class="block text-xs text-gray-500 mb-1">Fluid</label>
                    <input type="number" id="limit-f" class="w-full bg-gray-50 border p-2 rounded-lg" onchange="saveSettings()">
                </div>
                <div class="col-span-3 text-right">
                    <button onclick="clearAllData()" class="text-xs text-red-500 underline mt-2">Reset All Data</button>
                </div>
            </div>
        </details>

        <section class="bg-white p-5 rounded-2xl shadow-sm">
            <h2 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Net Daily Intake</h2>
            
            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1">
                    <span class="font-medium text-gray-600">Potassium (K)</span>
                    <span class="font-bold text-gray-800"><span id="total-k">0</span> / <span id="disp-limit-k">2000</span></span>
                </div>
                <div class="progress-bar-bg">
                    <div id="bar-k" class="progress-fill bg-blue-500" style="width: 0%"></div>
                </div>
            </div>

            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1">
                    <span class="font-medium text-gray-600">Net Phosphorus (P)</span>
                    <span class="font-bold text-gray-800"><span id="total-p">0</span> / <span id="disp-limit-p">1000</span></span>
                </div>
                <div class="progress-bar-bg">
                    <div id="bar-p" class="progress-fill bg-purple-500" style="width: 0%"></div>
                </div>
                <p class="text-xs text-gray-400 mt-1 text-right">*Adjusted for binders</p>
            </div>

            <div>
                <div class="flex justify-between text-sm mb-1">
                    <span class="font-medium text-gray-600">Fluid</span>
                    <span class="font-bold text-gray-800"><span id="total-f">0</span> / <span id="disp-limit-f">1000</span></span>
                </div>
                <div class="progress-bar-bg">
                    <div id="bar-f" class="progress-fill bg-teal-400" style="width: 0%"></div>
                </div>
            </div>
        </section>

        <div class="flex space-x-2 bg-gray-200 p-1 rounded-xl">
            <button onclick="switchTab('food')" id="tab-food" class="flex-1 py-2 rounded-lg font-bold text-sm bg-white shadow text-gray-800 transition">Add Food üçé</button>
            <button onclick="switchTab('binder')" id="tab-binder" class="flex-1 py-2 rounded-lg font-bold text-sm text-gray-500 hover:bg-white/50 transition">Add Binder üíä</button>
        </div>

        <section id="section-food" class="bg-white p-5 rounded-2xl shadow-sm">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Select Food</h2>
            <div class="space-y-3">
                <select id="category-select" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <option value="" disabled selected>Select Category</option>
                </select>
                <select id="food-select" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500" disabled>
                    <option value="" disabled selected>Select Category First</option>
                </select>
                <div id="food-details" class="hidden bg-blue-50 p-3 rounded-lg text-sm text-blue-800"></div>
                <button onclick="addFood()" id="add-food-btn" class="w-full bg-gray-800 text-white font-bold py-3 rounded-xl hover:bg-black transition disabled:opacity-50" disabled>Add Food</button>
            </div>
        </section>

        <section id="section-binder" class="hidden bg-white p-5 rounded-2xl shadow-sm border-l-4 border-green-400">
            <h2 class="text-lg font-semibold text-gray-700 mb-4">Take Binder</h2>
            <div class="space-y-3">
                <label class="block text-xs font-bold text-gray-500 uppercase">Medication</label>
                <select id="binder-select" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500">
                    <option value="" disabled selected>Select Binder</option>
                </select>
                
                <div id="binder-details" class="hidden bg-green-50 p-3 rounded-lg text-sm text-green-800"></div>

                <button onclick="addBinder()" id="add-binder-btn" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-700 transition disabled:opacity-50" disabled>
                    Take Binder
                </button>
            </div>
        </section>

        <section>
            <div class="flex justify-between items-end mb-3 px-1">
                <h2 class="text-lg font-semibold text-gray-700">Today's Log</h2>
                <button onclick="clearToday()" class="text-xs text-red-400 font-semibold">Clear Day</button>
            </div>
            <ul id="log-list" class="space-y-3"></ul>
        </section>

    </main>

    <script>
        // --- DATA ---
        const foodDatabase = {
            "Fruits": [
                { name: "Apple (Medium)", k: 195, p: 20, f: 0 },
                { name: "Banana (Medium)", k: 422, p: 26, f: 0 },
                { name: "Grapes (1 cup)", k: 288, p: 30, f: 0 },
                { name: "Watermelon (1 cup)", k: 170, p: 15, f: 140 }
            ],
            "Vegetables": [
                { name: "Carrots (1/2 cup cooked)", k: 180, p: 24, f: 0 },
                { name: "Potato (Baked, Med)", k: 926, p: 121, f: 0 },
                { name: "Spinach (Raw, 1 cup)", k: 167, p: 30, f: 0 }
            ],
            "Proteins": [
                { name: "Chicken Breast (3oz)", k: 220, p: 196, f: 0 },
                { name: "Egg (Large)", k: 69, p: 95, f: 0 },
                { name: "Salmon (3oz)", k: 326, p: 214, f: 0 }
            ],
            "Grains": [
                { name: "White Rice (1 cup)", k: 55, p: 68, f: 0 },
                { name: "White Bread (1 slice)", k: 30, p: 30, f: 0 }
            ],
            "Dairy": [
                { name: "Milk (1 cup)", k: 366, p: 232, f: 240 },
                { name: "Yogurt (Plain, 1 cup)", k: 579, p: 385, f: 200 }
            ],
            "Beverages": [
                { name: "Water (8oz)", k: 0, p: 0, f: 240 },
                { name: "Coffee (8oz)", k: 116, p: 7, f: 240 },
                { name: "Cola (12oz)", k: 0, p: 40, f: 355 }
            ]
        };

        const binderDatabase = [
            { name: "Calcium Carbonate (500 mg)", bind: 19 },
            { name: "Calcium Acetate (667 mg)", bind: 30 },
            { name: "Sevelamer HCl (800 mg)", bind: 17 },
            { name: "Lanthanum Carbonate (500 mg)", bind: 45 },
            { name: "Lanthanum Carbonate (750 mg)", bind: 68 },
            { name: "Velphoro (500 mg)", bind: 130 }
        ];

        // --- STATE & STORAGE ---
        let dailyLog = JSON.parse(localStorage.getItem('bean_log')) || [];
        let limits = JSON.parse(localStorage.getItem('bean_limits')) || { k: 2000, p: 1000, f: 1000 };

        // --- DOM ELEMENTS ---
        const categorySelect = document.getElementById('category-select');
        const foodSelect = document.getElementById('food-select');
        const binderSelect = document.getElementById('binder-select');
        const logList = document.getElementById('log-list');

        // --- INIT ---
        function init() {
            // Populate Food Categories
            Object.keys(foodDatabase).forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                categorySelect.appendChild(opt);
            });

            // Populate Binders
            binderDatabase.forEach((binder, index) => {
                const opt = document.createElement('option');
                opt.value = index;
                opt.textContent = binder.name;
                binderSelect.appendChild(opt);
            });

            // Load Inputs
            document.getElementById('limit-k').value = limits.k;
            document.getElementById('limit-p').value = limits.p;
            document.getElementById('limit-f').value = limits.f;

            renderLog();
            updateTotals();
        }

        // --- TABS ---
        function switchTab(tab) {
            document.getElementById('section-food').classList.toggle('hidden', tab !== 'food');
            document.getElementById('section-binder').classList.toggle('hidden', tab !== 'binder');
            
            // Style buttons
            const btnFood = document.getElementById('tab-food');
            const btnBinder = document.getElementById('tab-binder');
            
            if(tab === 'food') {
                btnFood.classList.add('bg-white', 'shadow', 'text-gray-800');
                btnFood.classList.remove('text-gray-500');
                btnBinder.classList.remove('bg-white', 'shadow', 'text-gray-800');
                btnBinder.classList.add('text-gray-500');
            } else {
                btnBinder.classList.add('bg-white', 'shadow', 'text-gray-800');
                btnBinder.classList.remove('text-gray-500');
                btnFood.classList.remove('bg-white', 'shadow', 'text-gray-800');
                btnFood.classList.add('text-gray-500');
            }
        }

        // --- EVENTS ---
        categorySelect.addEventListener('change', (e) => {
            const cat = e.target.value;
            foodSelect.innerHTML = '<option value="" disabled selected>Select Food</option>';
            foodSelect.disabled = false;
            foodDatabase[cat].forEach((food, idx) => {
                const opt = document.createElement('option');
                opt.value = idx;
                opt.textContent = food.name;
                foodSelect.appendChild(opt);
            });
            document.getElementById('food-details').classList.add('hidden');
            document.getElementById('add-food-btn').disabled = true;
        });

        foodSelect.addEventListener('change', (e) => {
            const cat = categorySelect.value;
            const food = foodDatabase[cat][e.target.value];
            const details = document.getElementById('food-details');
            details.innerHTML = `Contains: <b>${food.k}mg</b> K, <b>${food.p}mg</b> P, <b>${food.f}ml</b> Fluid`;
            details.classList.remove('hidden');
            document.getElementById('add-food-btn').disabled = false;
        });

        binderSelect.addEventListener('change', (e) => {
            const binder = binderDatabase[e.target.value];
            const details = document.getElementById('binder-details');
            details.innerHTML = `Binds: <b>-${binder.bind}mg</b> Phosphorus`;
            details.classList.remove('hidden');
            document.getElementById('add-binder-btn').disabled = false;
        });

        // --- LOGIC ---
        function addFood() {
            const cat = categorySelect.value;
            const idx = foodSelect.value;
            const item = { ...foodDatabase[cat][idx], type: 'food', id: Date.now() };
            dailyLog.push(item);
            saveAndRender();
            
            // Reset
            foodSelect.value = "";
            document.getElementById('add-food-btn').disabled = true;
            document.getElementById('food-details').classList.add('hidden');
        }

        function addBinder() {
            const idx = binderSelect.value;
            const binder = binderDatabase[idx];
            // Binders have negative P impact
            const item = { 
                name: binder.name, 
                k: 0, 
                p: -binder.bind, // Negative value
                f: 0, 
                type: 'binder', 
                id: Date.now() 
            };
            dailyLog.push(item);
            saveAndRender();

            binderSelect.value = "";
            document.getElementById('add-binder-btn').disabled = true;
            document.getElementById('binder-details').classList.add('hidden');
        }

        function removeItem(id) {
            dailyLog = dailyLog.filter(i => i.id !== id);
            saveAndRender();
        }

        function clearToday() {
            if(confirm("Clear today's log?")) {
                dailyLog = [];
                saveAndRender();
            }
        }
        
        function clearAllData() {
            if(confirm("Reset Settings and Log?")) {
                localStorage.clear();
                location.reload();
            }
        }

        function saveSettings() {
            limits.k = parseInt(document.getElementById('limit-k').value) || 2000;
            limits.p = parseInt(document.getElementById('limit-p').value) || 1000;
            limits.f = parseInt(document.getElementById('limit-f').value) || 1000;
            localStorage.setItem('bean_limits', JSON.stringify(limits));
            updateTotals();
        }

        function saveAndRender() {
            localStorage.setItem('bean_log', JSON.stringify(dailyLog));
            renderLog();
            updateTotals();
        }

        function updateTotals() {
            let totalK = 0, totalP = 0, totalF = 0;
            dailyLog.forEach(i => {
                totalK += i.k;
                totalP += i.p;
                totalF += i.f;
            });

            // Ensure P doesn't display as negative visually, but computationally it can start at 0
            const displayP = Math.max(0, totalP);

            document.getElementById('total-k').textContent = totalK;
            document.getElementById('total-p').textContent = displayP;
            document.getElementById('total-f').textContent = totalF;
            
            document.getElementById('disp-limit-k').textContent = limits.k;
            document.getElementById('disp-limit-p').textContent = limits.p;
            document.getElementById('disp-limit-f').textContent = limits.f;

            updateBar('bar-k', totalK, limits.k);
            updateBar('bar-p', displayP, limits.p);
            updateBar('bar-f', totalF, limits.f);
        }

        function updateBar(id, val, max) {
            const bar = document.getElementById(id);
            const pct = Math.min((val / max) * 100, 100);
            bar.style.width = pct + "%";
            
            bar.className = 'progress-fill transition-all duration-500 ';
            if (pct < 75) bar.classList.add(id === 'bar-f' ? 'bg-teal-400' : (id === 'bar-k' ? 'bg-blue-500' : 'bg-purple-500'));
            else if (pct < 100) bar.classList.add('bg-yellow-400');
            else bar.classList.add('bg-red-500');
        }

        function renderLog() {
            logList.innerHTML = dailyLog.length ? '' : '<li class="text-center text-gray-400 py-4 italic">Log is empty.</li>';
            
            // Show new items at top
            dailyLog.slice().reverse().forEach(item => {
                const li = document.createElement('li');
                
                if (item.type === 'binder') {
                    li.className = "bg-green-50 border border-green-100 p-3 rounded-xl shadow-sm flex justify-between items-center";
                    li.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-xl">üíä</span>
                            <div>
                                <div class="font-bold text-green-800 text-sm">${item.name}</div>
                                <div class="text-xs text-green-600">Bound ${Math.abs(item.p)}mg Phos</div>
                            </div>
                        </div>
                        <button onclick="removeItem(${item.id})" class="text-gray-400 hover:text-red-500 px-2">‚úï</button>
                    `;
                } else {
                    li.className = "bg-white p-3 rounded-xl shadow-sm flex justify-between items-center";
                    li.innerHTML = `
                        <div>
                            <div class="font-bold text-gray-800 text-sm">${item.name}</div>
                            <div class="text-xs text-gray-500 mt-1">
                                K: ${item.k} | P: ${item.p} | F: ${item.f}
                            </div>
                        </div>
                        <button onclick="removeItem(${item.id})" class="text-gray-400 hover:text-red-500 px-2">‚úï</button>
                    `;
                }
                logList.appendChild(li);
            });
        }

        // Run Init
        init();

    </script>
</body>
</html>